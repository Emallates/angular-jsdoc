<head>
  <link href="../css/prettify.css" type="text/css" rel="stylesheet">
  <script src="../js/prettify.js"></script>
</head>
<body onload="prettyPrint()">
  <div>Path: /Users/allen/github/angularjs-google-maps/directives/street-view-panorama.js</div>
  <div>TOC: [object Object]</div>
  <div>Total Number Of Lines: 98</div>
  <pre style="display:inline-block;text-align:right"><a id="line1">1.</a>
<a id="line2">2.</a>
<a id="line3">3.</a>
<a id="line4">4.</a>
<a id="line5">5.</a>
<a id="line6">6.</a>
<a id="line7">7.</a>
<a id="line8">8.</a>
<a id="line9">9.</a>
<a id="line10">10.</a>
<a id="line11">11.</a>
<a id="line12">12.</a>
<a id="line13">13.</a>
<a id="line14">14.</a>
<a id="line15">15.</a>
<a id="line16">16.</a>
<a id="line17">17.</a>
<a id="line18">18.</a>
<a id="line19">19.</a>
<a id="line20">20.</a>
<a id="line21">21.</a>
<a id="line22">22.</a>
<a id="line23">23.</a>
<a id="line24">24.</a>
<a id="line25">25.</a>
<a id="line26">26.</a>
<a id="line27">27.</a>
<a id="line28">28.</a>
<a id="line29">29.</a>
<a id="line30">30.</a>
<a id="line31">31.</a>
<a id="line32">32.</a>
<a id="line33">33.</a>
<a id="line34">34.</a>
<a id="line35">35.</a>
<a id="line36">36.</a>
<a id="line37">37.</a>
<a id="line38">38.</a>
<a id="line39">39.</a>
<a id="line40">40.</a>
<a id="line41">41.</a>
<a id="line42">42.</a>
<a id="line43">43.</a>
<a id="line44">44.</a>
<a id="line45">45.</a>
<a id="line46">46.</a>
<a id="line47">47.</a>
<a id="line48">48.</a>
<a id="line49">49.</a>
<a id="line50">50.</a>
<a id="line51">51.</a>
<a id="line52">52.</a>
<a id="line53">53.</a>
<a id="line54">54.</a>
<a id="line55">55.</a>
<a id="line56">56.</a>
<a id="line57">57.</a>
<a id="line58">58.</a>
<a id="line59">59.</a>
<a id="line60">60.</a>
<a id="line61">61.</a>
<a id="line62">62.</a>
<a id="line63">63.</a>
<a id="line64">64.</a>
<a id="line65">65.</a>
<a id="line66">66.</a>
<a id="line67">67.</a>
<a id="line68">68.</a>
<a id="line69">69.</a>
<a id="line70">70.</a>
<a id="line71">71.</a>
<a id="line72">72.</a>
<a id="line73">73.</a>
<a id="line74">74.</a>
<a id="line75">75.</a>
<a id="line76">76.</a>
<a id="line77">77.</a>
<a id="line78">78.</a>
<a id="line79">79.</a>
<a id="line80">80.</a>
<a id="line81">81.</a>
<a id="line82">82.</a>
<a id="line83">83.</a>
<a id="line84">84.</a>
<a id="line85">85.</a>
<a id="line86">86.</a>
<a id="line87">87.</a>
<a id="line88">88.</a>
<a id="line89">89.</a>
<a id="line90">90.</a>
<a id="line91">91.</a>
<a id="line92">92.</a>
<a id="line93">93.</a>
<a id="line94">94.</a>
<a id="line95">95.</a>
<a id="line96">96.</a>
<a id="line97">97.</a>
<a id="line98">98.</a>
  </pre>
  <pre class="prettyprint" style="display:inline-block">/**
 * @ngdoc directive
 * @name streetview-panorama
 * @requires Attr2Options
 * @description
 *   Requires:  map directive
 *   Restrict To:  Element
 *
 * @param container Optional, id or css selector, if given, streetview will be in the given html element
 * @param {String} &lt;StreetViewPanoramaOption> Any Google StreetViewPanorama options, 
 *        https://developers.google.com/maps/documentation/javascript/reference?csw=1#StreetViewPanoramaOptions
 * @param {String} &lt;StreetViewPanoramaEvent> Any Google StreetViewPanorama events, 
 *        https://developers.google.com/maps/documentation/javascript/reference#StreetViewPanorama 
 *
 * @example
 *   &lt;map zoom="11" center="[40.688738,-74.043871]" >
 *     &lt;street-view-panorama
 *       click-to-go="true"
 *       disable-default-ui="true"
 *       disable-double-click-zoom="true"
 *       enable-close-button="true"
 *       pano="my-pano"
 *       position="40.688738,-74.043871"
 *       pov="{heading:0, pitch: 90}"
 *       scrollwheel="false"
 *       visible="true">
 *     &lt;/street-view-panorama>
 *   &lt;/map>
 */
/* global google */
(function() {
  'use strict';
   
  var streetViewPanorama = function(Attr2Options) {
    var parser = Attr2Options;
  
    var getStreetViewPanorama = function(map, options, events) {
      var svp, container;
      if (options.container) {
        container = document.getElementById(options.container);
        container = container || document.querySelector(options.container);
      }
      if (container) {
        svp = new google.maps.StreetViewPanorama(container, options);
      } else {
        svp = map.getStreetView();
        svp.setOptions(options);
      }

      for (var eventName in events) {
        eventName &&
          google.maps.event.addListener(svp, eventName, events[eventName]);
      }
      return svp;
    };

    var linkFunc = function(scope, element, attrs, mapController) {
      var orgAttrs = parser.orgAttributes(element);
      var filtered = parser.filter(attrs);
      var options = parser.getOptions(filtered);
      var controlOptions = parser.getControlOptions(filtered);
      var svpOptions = angular.extend(options, controlOptions);

      var svpEvents = parser.getEvents(scope, filtered);
      console.log('street-view-panorama', 
        'options', svpOptions, 'events', svpEvents);
 
      scope.$on('mapInitialized', function(evt, map) {
        var svp = getStreetViewPanorama(map, svpOptions, svpEvents);

        map.setStreetView(svp);
        (!svp.getPosition()) && svp.setPosition(map.getCenter());
        google.maps.event.addListener(svp, 'position_changed', function() {
          if (svp.getPosition() !== map.getCenter()) {
            map.setCenter(svp.getPosition());
          }
        });
        //needed for geo-callback
        var listener = google.maps.event.addListener(map, 'center_changed', function() {
          svp.setPosition(map.getCenter());
          google.maps.event.removeListener(listener);
        });
      });

    }; //link

    return {
      restrict: 'E',
      require: '^map',
      link: linkFunc
    };

  };
  streetViewPanorama.$inject = ['Attr2Options'];

  angular.module('ngMap').directive('streetViewPanorama', streetViewPanorama);
})();

  </pre>
</body>
